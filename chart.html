<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Trend Chart</title>

<script src="d3.v3.js" charset="utf-8"></script>
<script src="jquery-1.10.2.js" charset="utf-8"></script>

</head><body>

<div id='chart'></div>
<div id='tooltip'></div>

<script src="data.js" charset="utf-8"></script>
<script>

(function($){
    var MND3 = {
        init: function(obj){
            if (!obj) {
                console.log('No data available');
                return false;
            }

            var data = this.data = obj.ChartValues;
            var labels = this.labels = obj.ChartLabels;
            var lines = this.lines = [];

            this.populateTooltip(labels);

            var minDate = data[0].date,
                maxDate = data[data.length-1].date;

            $(labels).each(function(){
                var exclude = ['date', 'tooltip', 'annotation'];
                if (exclude.indexOf(this[0]) === -1) {
                    lines.push(this[0]);
                }
            });

            var minValue = data[0][lines[0]],
                maxValue = data[0][lines[0]];

            $(data).each(function(){
                var _this = this;
                $(lines).each(function(){
                    var value = _this[this];
                    if (value < minValue) {
                        minValue = value;
                    }
                    if (value > maxValue) {
                        maxValue = value;
                    }
                });
            });

            var w = 620,
                h = 380,
                p = 30,
                y = d3.scale.linear().domain([minValue, maxValue]).range([h, 0]),
                x = d3.time.scale().domain([minDate, maxDate]).range([0, w]);

            var vis = d3.select('#chart')
            .data([data])
            .append("svg:svg")
            .attr("width", w + p * 2)
            .attr("height", h + p * 2)
            .append("svg:g")
            .attr("transform", "translate(" + p + "," + p + ")");

            var xAxis = d3.svg.axis()
              .scale(x)
              .orient("bottom")
              .ticks(12)
              .tickFormat(d3.time.format("%m/%d/%Y"));

            vis.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + h + ")")
              .call(xAxis);

            $(lines).each(function(){

                var lineLabel = this;

                vis.append("svg:path")
                .attr("class", "line")
                .attr("data-group", lineLabel)
                .attr("d", d3.svg.line()
                    .x(function(d) { return x(d.date) })
                    .y(function(d) { return y(d[lineLabel]) })
                );

                vis.selectAll("circle.line")
                .data(data)
                .enter().append("svg:circle")
                .attr("class", "point")
                .attr("data-group", lineLabel)
                .attr("cx", function(d) { return x(d.date) })
                .attr("cy", function(d) { return y(d[lineLabel]) })
                .attr("r", 1.5)
                .on('mouseover', MND3.pointFocus)
                .on('mouseout', MND3.pointBlur);
            });

        },
        pointFocus: function(){
            $(this).attr('r', 5);
            var grp = $(this).attr('data-group');
            var line = $("path[data-group='" + grp + "']");
            line.attr("class", "active line");
            console.log(this);
            $(MND3.labels).each(function(){
                var val = $(line).attr(this[0]);
                if(this[0] === 'date'){
                    var format = d3.time.format("%m/%d/%Y %H:%M:%S");
                    val = val ? format(val) : 'N/A';
                }
                $('#tooltip .'+ this[0] +' .value').text(val);
            })
            $('#tooltip').show();
        },
        pointBlur: function(){
            $(this).attr('r', 1);
            var grp = $(this).attr('data-group');
            var line = $("path[data-group='" + grp + "']");
            line.attr("class", "line");
            $('#tooltip').hide();
        },
        populateTooltip: function(labels){
            $(labels).each(function(){
                var row = $("<div class='row "+this[0]+"'></div>");
                var label = $("<span class='label'>"+this[1]+": </span>");
                var value = $("<span class='value'></span>");
                $('#tooltip').append(row.append(label).append(value));
            })
        }
    };

    $(document).ready(function(){
        MND3.init(ChartData);
    });
}(jQuery));
</script>
<style type='text/css'>
#tooltip{
    display:none;
}
line {
  stroke: black;
}
path {
    z-index:100;
    fill: none;
    stroke-width:3px;
}
path.active, path:hover {
    stroke-width:5px;
}

.line[data-group="x1"]{stroke: #00BFFF;}
.line[data-group="x2"]{stroke: #32CD32;}
.line[data-group="x3"]{stroke: #A9A9A9;}
.line[data-group="x4"]{stroke: #008000;}

circle: {
    stroke:none;
}

.point[data-group="x1"]{fill: #00BFFF;}
.point[data-group="x2"]{fill: #32CD32;}
.point[data-group="x3"]{fill: #A9A9A9;}
.point[data-group="x4"]{fill: #008000;}

</style>
</body></html>